<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="J2zLkdrNa6i2FBLEdOTOocpN2NV-gizUUNTQsLm-jjs" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-5682062742990204">
    <title>RiskCast AI | Monte Carlo Business Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google AdSense Main Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5682062742990204" crossorigin="anonymous"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(226, 232, 240, 1); }
        
        /* Ad Space Container Styling */
        .ad-space { 
            background: #f1f5f9; 
            border: 1px dashed #cbd5e0; 
            overflow: hidden;
            border-radius: 1rem;
            text-align: center;
        }

        /* Animations */
        .pulse-blue { animation: pulse-blue 2s infinite; }
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(37, 99, 235, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
        }

        .data-stream {
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            background-size: 200% 100%;
            animation: data-flow 1.5s linear infinite;
        }
        @keyframes data-flow {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .floating { animation: floating 3s ease-in-out infinite; }
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        #progress-bar-fill { transition: width 0.4s ease; }
        
        #log-terminal::-webkit-scrollbar { width: 4px; }
        #log-terminal::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-800">

    <!-- Navigation -->
    <nav class="bg-white border-b border-slate-200 px-6 py-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-2 mx-auto md:mx-0">
            <div class="bg-blue-600 p-2 rounded-lg">
                <i class="fas fa-chart-line text-white text-xl"></i>
            </div>
            <h1 class="text-xl font-bold tracking-tight text-slate-900">RiskCast <span class="text-blue-600">AI</span></h1>
        </div>
        <div class="hidden md:flex items-center gap-4">
             <span class="text-xs font-medium text-slate-400 bg-slate-100 px-2 py-1 rounded">v2.1 Stable</span>
        </div>
    </nav>

    <!-- Top Banner Ad Space -->
    <div class="max-w-7xl mx-auto mt-6 px-4">
        <div class="ad-space min-h-[100px] w-full shadow-sm">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-5682062742990204"
                 data-ad-slot="6980184117"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>

    <main class="max-w-7xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Column: Input & AI Analysis -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- API Configuration -->
            <div class="glass-card p-5 rounded-2xl shadow-sm border border-amber-100 bg-amber-50/30">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-xs font-bold text-amber-700 uppercase tracking-widest">API Configuration</h2>
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-[10px] text-blue-600 hover:underline font-bold">Get Free Key <i class="fas fa-external-link-alt"></i></a>
                </div>
                <input type="password" id="custom-api-key" class="w-full text-xs p-3 rounded-xl border border-amber-200 focus:ring-2 focus:ring-amber-500 outline-none transition bg-white" placeholder="Enter Gemini API Key...">
                <p class="text-[10px] text-amber-600/70 mt-2 leading-tight">Your key is stored only in this browser session for analysis purposes.</p>
            </div>

            <div class="glass-card p-6 rounded-2xl shadow-sm border-t-4 border-t-blue-600">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-file-upload text-blue-500"></i> Business Data
                </h2>
                
                <div id="drop-zone" class="border-2 border-dashed border-slate-200 rounded-xl p-6 text-center hover:border-blue-400 transition cursor-pointer bg-slate-50 mb-4">
                    <input type="file" id="file-input" class="hidden" accept=".pdf,.txt,.png,.jpg">
                    <i class="fas fa-cloud-upload-alt text-2xl text-slate-400 mb-2"></i>
                    <p class="text-xs font-medium text-slate-600">Click or drag & drop files</p>
                </div>

                <div id="file-preview" class="mb-4 hidden p-3 bg-blue-50 border border-blue-100 rounded-lg flex items-center justify-between">
                    <div class="flex items-center gap-2 overflow-hidden">
                        <i class="fas fa-file-invoice text-blue-600"></i>
                        <span id="file-name" class="text-xs font-medium truncate">document.pdf</span>
                    </div>
                    <button onclick="removeFile()" class="text-slate-400 hover:text-red-500"><i class="fas fa-times"></i></button>
                </div>

                <div class="space-y-2 mb-6">
                    <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">Additional Context (Optional)</label>
                    <textarea id="user-context" rows="4" class="w-full text-sm p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Tell us about your industry, runway, or specific risks..."></textarea>
                </div>

                <button id="analyze-btn" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-bolt"></i> Run Simulation
                </button>
            </div>

            <!-- Sidebar Vertical Ad Space -->
            <div class="ad-space min-h-[250px] w-full shadow-sm">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-5682062742990204"
                     data-ad-slot="6980184117"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>

        <!-- Right Column: Results & Visualization -->
        <div class="lg:col-span-8 space-y-6">
            
            <!-- Loading View -->
            <div id="ai-status" class="glass-card p-12 rounded-3xl shadow-xl hidden border-2 border-blue-100 flex flex-col items-center justify-center text-center overflow-hidden relative">
                <div class="absolute top-0 left-0 w-full h-1 data-stream"></div>
                <div class="relative mb-8">
                    <div class="w-24 h-24 bg-blue-600 rounded-full flex items-center justify-center pulse-blue floating z-10 relative">
                        <i class="fas fa-brain text-4xl text-white"></i>
                    </div>
                    <div class="absolute -top-4 -left-4 w-32 h-32 border border-blue-200 rounded-full animate-spin" style="animation-duration: 4s;"></div>
                </div>
                <h2 id="status-text" class="text-2xl font-bold text-slate-800 mb-2">Initializing Neural Analysis...</h2>
                <div class="w-full max-w-md bg-slate-100 h-2 rounded-full mb-6 overflow-hidden">
                    <div id="progress-bar-fill" class="bg-blue-600 h-full w-0"></div>
                </div>
                <div class="w-full max-w-md bg-slate-900 rounded-xl p-4 text-left font-mono text-[10px] text-blue-400 h-32 overflow-y-auto shadow-inner" id="log-terminal">
                    <div>> System ready...</div>
                </div>
            </div>

            <!-- Welcome View -->
            <div id="welcome-view" class="space-y-6">
                <div class="glass-card p-8 rounded-2xl text-center border-dashed border-2">
                    <div class="bg-blue-50 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600">
                        <i class="fas fa-microchip text-xl"></i>
                    </div>
                    <h2 class="text-xl font-bold mb-1 text-slate-700">Financial Stress-Testing</h2>
                    <p class="text-slate-500 text-sm max-w-md mx-auto">Analyze business viability using 10,000 parallel Monte Carlo simulations based on your raw financial documents.</p>
                </div>

                <!-- Recommended Files Section -->
                <div class="glass-card p-6 rounded-2xl">
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2">
                        <i class="fas fa-list-check text-blue-500"></i> Recommended Data Sources
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition border border-transparent hover:border-slate-100">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center text-green-600 flex-shrink-0">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                            <div>
                                <h4 class="text-xs font-bold">P&L Statements</h4>
                                <p class="text-[10px] text-slate-400">Best for revenue & expense baseline.</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 transition border border-transparent hover:border-slate-100">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 flex-shrink-0">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div>
                                <h4 class="text-xs font-bold">Pitch Decks</h4>
                                <p class="text-[10px] text-slate-400">Best for identifying growth assumptions.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mid-Content Ad Space -->
                <div class="ad-space min-h-[120px] w-full">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-5682062742990204"
                         data-ad-slot="6980184117"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass-card p-6 rounded-2xl">
                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mb-4 text-blue-600">
                            <i class="fas fa-brain text-sm"></i>
                        </div>
                        <h3 class="font-bold text-sm mb-2">Gemini 2.5 Parsing</h3>
                        <p class="text-xs text-slate-500">Automatically extracts financial parameters from unstructured text, images, or PDF data.</p>
                    </div>
                    <div class="glass-card p-6 rounded-2xl">
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mb-4 text-purple-600">
                            <i class="fas fa-dice text-sm"></i>
                        </div>
                        <h3 class="font-bold text-sm mb-2">Stochastic Modeling</h3>
                        <p class="text-xs text-slate-500">Traditional "best guesses" fail. We model the chaos of the market to see where you break.</p>
                    </div>
                </div>

                <div class="glass-card p-6 rounded-2xl bg-gradient-to-br from-slate-900 to-blue-900 text-white border-none relative overflow-hidden">
                    <div class="relative z-10">
                        <h3 class="font-bold text-lg mb-2">Probability Over Prediction</h3>
                        <p class="text-sm text-blue-100 opacity-80 leading-relaxed">Don't rely on a single spreadsheet row. RiskCast runs 10k simulations per request to identify the statistical probability of your business surviving market shocks.</p>
                    </div>
                    <i class="fas fa-shield-halved absolute -right-4 -bottom-4 text-8xl opacity-10"></i>
                </div>
            </div>

            <!-- Results View -->
            <div id="results-view" class="space-y-6 hidden">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="glass-card p-6 rounded-2xl border-l-4 border-l-blue-500 shadow-sm">
                        <p class="text-xs font-bold text-slate-500 uppercase mb-1">Mean Net Profit</p>
                        <h3 id="stat-mean" class="text-2xl font-bold text-slate-800">$0</h3>
                    </div>
                    <div class="glass-card p-6 rounded-2xl border-l-4 border-l-red-500 shadow-sm">
                        <p class="text-xs font-bold text-slate-500 uppercase mb-1">Risk of Ruin</p>
                        <h3 id="stat-risk" class="text-2xl font-bold text-red-600">0%</h3>
                    </div>
                    <div class="glass-card p-6 rounded-2xl border-l-4 border-l-green-500 shadow-sm">
                        <p class="text-xs font-bold text-slate-500 uppercase mb-1">95th Percentile</p>
                        <h3 id="stat-max" class="text-2xl font-bold text-slate-800">$0</h3>
                    </div>
                </div>

                <div class="glass-card p-6 rounded-2xl shadow-sm">
                    <h3 class="font-bold mb-4 text-sm uppercase tracking-wider text-slate-400">Outcome Distribution</h3>
                    <div class="h-[350px]">
                        <canvas id="monteCarloChart"></canvas>
                    </div>
                </div>

                <!-- Results Context Ad Space -->
                <div class="ad-space min-h-[90px] w-full bg-white shadow-sm border-slate-100">
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-5682062742990204"
                         data-ad-slot="6980184117"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="glass-card p-6 rounded-2xl">
                        <h3 class="font-bold mb-4 flex items-center gap-2 text-red-600">
                            <i class="fas fa-skull-crossbones"></i> Sinking Points
                        </h3>
                        <ul id="sinking-points" class="space-y-3 text-sm"></ul>
                    </div>
                    <div class="glass-card p-6 rounded-2xl">
                        <h3 class="font-bold mb-4 flex items-center gap-2 text-green-600">
                            <i class="fas fa-shield-alt"></i> Mitigation Strategy
                        </h3>
                        <div id="mitigation-plan" class="text-sm text-slate-600 leading-relaxed italic border-l-2 border-green-200 pl-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Ad Space -->
    <div class="max-w-7xl mx-auto mb-8 px-4">
        <div class="ad-space min-h-[90px] w-full">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-5682062742990204"
                 data-ad-slot="6980184117"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>

    <footer class="max-w-7xl mx-auto px-8 pb-12 text-center text-slate-400 text-[10px]">
        <p>&copy; 2024 RiskCast AI. All analysis processed securely via Gemini AI.</p>
    </footer>

    <script>
        // Environment handling
        let apiKey = ""; 
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'riskcast-v2';
        
        let chartInstance = null;
        let selectedFile = null;

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const filePreview = document.getElementById('file-preview');
        const fileNameDisp = document.getElementById('file-name');
        const userContext = document.getElementById('user-context');
        const analyzeBtn = document.getElementById('analyze-btn');
        const customApiKeyInput = document.getElementById('custom-api-key');
        
        const aiStatus = document.getElementById('ai-status');
        const statusText = document.getElementById('status-text');
        const progressBar = document.getElementById('progress-bar-fill');
        const logTerminal = document.getElementById('log-terminal');
        const welcomeView = document.getElementById('welcome-view');
        const resultsView = document.getElementById('results-view');

        // Restore key if previously entered in this session
        const storedKey = sessionStorage.getItem('riskcast_api_key');
        if (storedKey) customApiKeyInput.value = storedKey;

        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => e.target.files.length > 0 && handleFile(e.target.files[0]);
        
        function handleFile(file) {
            selectedFile = file;
            fileNameDisp.innerText = file.name;
            filePreview.classList.remove('hidden');
        }

        function removeFile() {
            selectedFile = null;
            filePreview.classList.add('hidden');
            fileInput.value = '';
        }

        function logToTerminal(msg) {
            const div = document.createElement('div');
            div.innerHTML = `<span class="text-slate-500">[${new Date().toLocaleTimeString([], {hour12:false})}]</span> > ${msg}`;
            logTerminal.appendChild(div);
            logTerminal.scrollTop = logTerminal.scrollHeight;
        }

        async function startAnimationSequence() {
            progressBar.style.width = '0%';
            logTerminal.innerHTML = '<div>> Initializing analysis pipeline...</div>';
            
            const steps = [
                { p: 15, msg: "Reading file buffers...", log: "Ingesting document stream..." },
                { p: 35, msg: "Extracting Parameters...", log: "Neural engine identifying revenue/burn nodes..." },
                { p: 55, msg: "Modeling Volatility...", log: "Assigning stochastic distribution factors..." },
                { p: 75, msg: "Iterating Simulations...", log: "Processing 10,000 parallel Monte Carlo timelines..." },
                { p: 90, msg: "Finalizing Report...", log: "Aggregating 95th percentile risk data..." }
            ];

            for (const step of steps) {
                statusText.innerText = step.msg;
                progressBar.style.width = step.p + '%';
                logToTerminal(step.log);
                await new Promise(r => setTimeout(r, 1000));
            }
        }

        analyzeBtn.onclick = async () => {
            apiKey = customApiKeyInput.value.trim();
            if (!apiKey) {
                alert("Please provide a Gemini API Key to proceed. You can get one for free at Google AI Studio.");
                return;
            }
            
            sessionStorage.setItem('riskcast_api_key', apiKey);

            analyzeBtn.disabled = true;
            aiStatus.classList.remove('hidden');
            welcomeView.classList.add('hidden');
            resultsView.classList.add('hidden');

            const animationTask = startAnimationSequence();

            try {
                let base64Data = null;
                let mimeType = null;
                if (selectedFile) {
                    base64Data = await fileToBase64(selectedFile);
                    mimeType = selectedFile.type;
                }

                const extractedParams = await extractVariablesWithAI(base64Data, mimeType, userContext.value);
                
                await animationTask;

                const simulationData = runMonteCarlo(extractedParams);
                updateDashboard(simulationData, extractedParams);
                
                progressBar.style.width = '100%';
                logToTerminal("Simulations finished. Outcome generated.");
                await new Promise(r => setTimeout(r, 500));

                aiStatus.classList.add('hidden');
                resultsView.classList.remove('hidden');
            } catch (error) {
                console.error(error);
                statusText.innerText = "Processing Error";
                logToTerminal("ERROR: Analysis pipeline failed. Ensure your API key is valid.");
            } finally {
                analyzeBtn.disabled = false;
            }
        };

        async function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        async function extractVariablesWithAI(base64, mimeType, context) {
            const systemPrompt = `You are a risk analyst. Analyze the business context and files. Estimate: 
            1. baseline_revenue (monthly)
            2. growth_rate (monthly fraction)
            3. burn_rate (monthly fixed costs)
            4. volatility (0.1 to 0.5 decimal)
            5. sinking_points (3 strings)
            6. mitigation_plan (short paragraph)
            Return ONLY JSON.`;
            
            const parts = [{ text: `Context: ${context || "Not provided."}` }];
            if (base64) parts.push({ inlineData: { mimeType, data: base64 } });

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: { responseMimeType: "application/json" }
                })
            });

            if (!response.ok) throw new Error("API Request Failed");
            const result = await response.json();
            return JSON.parse(result.candidates[0].content.parts[0].text);
        }

        function runMonteCarlo(params) {
            const trials = 10000;
            const months = 12;
            const results = [];
            for (let i = 0; i < trials; i++) {
                let currentCash = 0;
                let revenue = params.baseline_revenue || 10000;
                for (let m = 0; m < months; m++) {
                    const variance = (Math.random() + Math.random() + Math.random() + Math.random() - 2) / 2;
                    const monthlyGrowth = (params.growth_rate || 0.02) + (variance * (params.volatility || 0.2));
                    revenue = revenue * (1 + monthlyGrowth);
                    currentCash += (revenue - (params.burn_rate || 8000));
                }
                results.push(currentCash);
            }
            return results.sort((a, b) => a - b);
        }

        function updateDashboard(results, params) {
            const mean = results.reduce((a, b) => a + b) / results.length;
            const riskOfRuin = (results.filter(v => v < 0).length / results.length) * 100;
            const p95 = results[Math.floor(results.length * 0.95)];

            document.getElementById('stat-mean').innerText = formatCurrency(mean);
            document.getElementById('stat-risk').innerText = riskOfRuin.toFixed(1) + '%';
            document.getElementById('stat-max').innerText = formatCurrency(p95);

            const sinkingList = document.getElementById('sinking-points');
            sinkingList.innerHTML = '';
            (params.sinking_points || []).forEach(point => {
                const li = document.createElement('li');
                li.className = 'bg-red-50 p-3 rounded-xl border border-red-100 flex gap-2 text-red-800';
                li.innerHTML = `<i class="fas fa-warning text-red-500 mt-1"></i> <span>${point}</span>`;
                sinkingList.appendChild(li);
            });

            document.getElementById('mitigation-plan').innerText = params.mitigation_plan;
            renderChart(results);
        }

        function renderChart(results) {
            const ctx = document.getElementById('monteCarloChart').getContext('2d');
            const bucketCount = 30;
            const min = results[0], max = results[results.length - 1];
            const range = max - min, bucketSize = range / bucketCount;
            const buckets = new Array(bucketCount).fill(0), labels = [];

            for (let i = 0; i < bucketCount; i++) {
                const start = min + (i * bucketSize);
                labels.push(formatCurrencyShort(start));
                results.forEach(val => { if (val >= start && val < start + bucketSize) buckets[i]++; });
            }

            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: buckets,
                        backgroundColor: (context) => (min + (context.dataIndex * bucketSize)) < 0 ? 'rgba(239, 68, 68, 0.7)' : 'rgba(59, 130, 246, 0.7)',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { display: false }, x: { grid: { display: false }, ticks: { maxRotation: 45, font: { size: 9 } } } }
                }
            });
        }

        function formatCurrency(v) { return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(v); }
        function formatCurrencyShort(v) { 
            if (Math.abs(v) >= 1000000) return (v / 1000000).toFixed(1) + 'M';
            if (Math.abs(v) >= 1000) return (v / 1000).toFixed(0) + 'k';
            return v.toFixed(0);
        }
    </script>
</body>
</html>
